{% extends 'dashboard/base.html' %}

{% block content %}
<form id="editPost" v-on:submit.prevent="submitPost">
    {% csrf_token %}
    <table class="table">
        <tr>
            <td>Title</td>
            <td><input v-model="post.headline"></td>
       </tr>
       <tr>
           <td>Content</td>
           <td><textarea v-model="post.text"></textarea></td>
       </tr>
    </table>
    <button class="btn btn-default btn-right" type="submit">Submit</button>
</form>

<script>
    new Vue({
        el: '#editPost',
        data: {
            'post': {},
            csrf: null
        },
        mounted() {
            this.$set(this, 'csrf', this.$el.firstChild.value)

            this.getPost()
        },
        methods: {
            getPost () {
                axios({
                    method: 'get',
                    url: '{{ request.get_full_path }}',
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                }).then((response) => {
                    let data = response.data
                    this.post = data[0] ? data[0].fields : {}
                })
            },
            submitPost () {
                axios({
                    method: 'post',
                    url: '{{ request.get_full_path }}',
                    data: this.post,
                    headers: {
                        'X-CSRFToken': this.csrf,
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                })
            }
        }
    })
</script>
{% endblock content %}
