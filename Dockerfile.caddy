# DJANGO BUILDER #
FROM python:3.6 as django_builder

# Install requirements.
COPY requirements/ /requirements
RUN pip install -r /requirements/base.txt

# Copy source code.
COPY server/ /src

WORKDIR /src
RUN mkdir -p bundle/static/
RUN python manage.py collectstatic --noinput

# CADDY IMAGE #
FROM abiosoft/caddy:no-stats

# Copy django's static files
COPY --from=django_builder /src/static /srv/server

COPY Caddyfile /etc/Caddyfile
